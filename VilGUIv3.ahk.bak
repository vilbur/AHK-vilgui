#Include %A_LineFile%\..\Lib\Includes.ahk

global $GUI := {}
global $GUI_margin

/** Class VilGUIv3
*/
Class VilGUIv3{

	;_Tabs	:= []

	__New($hwnd){
		this.hwnd	:= $hwnd
		this.Margin	:= new GuiMargin_vgui()
		$GUI[$hwnd]	:= this
		$GUI_margin	:= this.Margin ; Set Global Margin BBFORE Layout Configured
		this.Controls	:= new Controls_vgui().parent(this).hwnd(this.hwnd)
		this.Gui	:= new Gui_vgui().parent(this)
		this.Events	:= new Events_vgui().parent(this)
		this.Menus	:= new Menus()
	}
	/** create()
	*/
	create(){
		;Gui, % this.hwnd ":Show", , % this.hwnd
		;Dump(this.Controls, "this.Controls", 0)

		this.sortLayouts()
		this.Menus.Main.show(this.hwnd)
		this.Menus.Tray.show()

		;this.Events.allowWindowEvents() ;  Bind window events after window is created
		;this.Events.Mouse.bindWheel()
		;Dump(this, "this.", 0)
		return this
	}
	/** submit gui
		@return object values of all controls
	*/
	submit(){
		;MsgBox,262144,, submit,2
		$form_data := this.Controls.values()
		;For $t, $tabs in this.Controls._list.Tabs
		For $tabs_name, $address in this.Controls.Types.Tabs
				$form_data[$tabs_name] := this[$tabs_name].getControlsValues()
		Dump($form_data, "form_data", 1)
		return %$form_data%
	}
	/** close
	*/
	close(){
		this.Gui._guiOption("Destroy")
	}
	/** exit
	*/
	exit($callback_custom:=""){
		if(!$callback_custom)
			ExitApp
	}
	/*---------------------------------------
		Layout
	-----------------------------------------
	*/
	/** sortLayouts
	*/
	sortLayouts(){
		;this.Controls.Layout.ContainerMain.origin({"x":$GUI_margin.ui.x(), "y": $GUI_margin.ui.y()}) ; Set margins to TOP & LEFT of UI
		this.Controls._Layout.sort()	; Sort layout
		this._sortTabsLayout()	; Sort layout in tabs

	}
	/** _sortTabsLayout
	*/
	_sortTabsLayout(){
		;Dump(this, "this.", 0)
		;if(this.Controls.Types.getCountOfType(Tab2))
		;	For $t, $tabs in this.Controls.List.Tabs {
		;		;Dump($tabs, "tabs", 1)
		;		;this[$tabs.name].sortTabsLayouts()
		;		;$tabs.sortTabsLayouts()
		;		this.Layout.sort()	; Sort layout again - Sort controls under tabs
		;	}
			For $tabs_name, $address in this.Controls.Types.Tabs {
				this[$tabs_name].sortTabsLayouts()
				this.Controls._Layout.sort()	; Sort layout again - Sort controls under tabs
			}
	}
	/** tabs
	*/
	tabs($tabs){
		return % new Tabs_vgui(this.Controls).items($tabs)
	}


}












